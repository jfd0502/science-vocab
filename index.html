<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Sojourn</title>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --text: #0f172a; --accent: #16a34a; --danger: #dc2626; }
        
        /* FIX: Ensure the background is solid immediately and app content is invisible */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: rgb(10, 15, 28); 
            color: var(--text); 
            padding: 0; margin: 0; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; position: relative; overflow-x: hidden; 
        }
        
        /* HIDE APP CONTENT ON LOAD */
        .app-container, .mode-toggle { 
            z-index: 1; 
            opacity: 0; 
            pointer-events: none; 
            transition: opacity 0.5s ease;
        }

        /* 2. THE ANIMATION CANVAS (Middle Layer) */
        #matrixCanvas { 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            z-index: 2; 
            pointer-events: none; 
        }

        /* 3. THE UI OVERLAY (Front-most) */
        #landingPage { 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: transparent; 
            z-index: 9999; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            transition: opacity 0.8s ease; 
        }

        .welcome-title { 
            font-size: 3.5rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 20px; 
            color: white;
            animation: reveal 1.2s cubic-bezier(0.77, 0, 0.175, 1) forwards; 
            text-shadow: 0 0 25px rgba(37, 99, 235, 1), 0 2px 10px rgba(0,0,0,1); 
        }
        
        .sojourn-def { 
            font-style: italic; font-size: 1.2rem; color: #f8fafc; margin-bottom: 40px; 
            opacity: 0; animation: reveal 1s ease forwards; animation-delay: 0.8s; 
            max-width: 80%; text-shadow: 0 2px 10px rgba(0,0,0,1); text-align: center;
        }
        
        .start-btn { 
            background: var(--primary); color: white; border: none; padding: 18px 36px; 
            font-size: 1.2rem; font-weight: bold; border-radius: 50px; cursor: pointer; 
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.6); 
            transition: transform 0.3s, background 0.3s; 
            opacity: 0; animation: reveal 1s ease forwards; animation-delay: 1.4s; 
        }
        .start-btn:hover { transform: scale(1.05); background: #1d4ed8; }

        @keyframes reveal { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }

        /* INTERIOR APP STYLES */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.95); display: flex; align-items: center; justify-content: center; z-index: 20000; color: white; }
        .login-box { background: white; color: var(--text); padding: 30px; border-radius: 15px; text-align: center; width: 90%; max-width: 400px; }
        .mode-toggle { position: absolute; top: 15px; left: 15px; background: #64748b; color: white; border: none; border-radius: 8px; padding: 8px 14px; font-size: 0.75rem; cursor: pointer; }
        .nav-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin: 10px 0; }
        .nav-btn { background: white; border: 2px solid #e2e8f0; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .breadcrumb { font-size: 0.9rem; color: #64748b; margin-bottom: 10px; cursor: pointer; text-align: left; width: 100%; }
        .app-container { padding: 60px 20px 20px 20px; width: 100%; max-width: 600px; display: flex; flex-direction: column; position: relative; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; width: 100%; box-sizing: border-box; }
        .hidden { display: none !important; }
        .flashcard { height: 280px; perspective: 1000px; cursor: pointer; margin: 20px 0; }
        .inner { position: relative; width: 100%; height: 100%; transition: 0.6s; transform-style: preserve-3d; border: 2px solid #e2e8f0; border-radius: 15px; }
        .flipped .inner { transform: rotateY(180deg); }
        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 1.4rem; padding: 20px; text-align: center; box-sizing: border-box; border-radius: 13px; background: white; }
        .back { background: var(--primary); color: white; transform: rotateY(180deg); font-size: 1.1rem; overflow-y: auto; }
        .quiz-option { background: white; border: 2px solid #e2e8f0; padding: 12px; margin: 8px 0; border-radius: 8px; cursor: pointer; text-align: left; }
        .correct { background: #dcfce7 !important; border-color: #22c55e !important; }
        .incorrect { background: #fee2e2 !important; border-color: #ef4444 !important; }
        .match-container { display: flex; gap: 15px; margin-top: 10px; }
        .match-col { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .match-item { padding: 10px; background: white; border: 2px solid #cbd5e1; border-radius: 8px; cursor: grab; text-align: center; min-height: 80px; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; }
        input, select, .main-btn { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #cbd5e1; box-sizing: border-box; }
        .main-btn { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>

    <div id="landingPage">
        <h1 class="welcome-title">Vocabulary Sojourn</h1>
        <div class="sojourn-def">so-journ (n): a temporary stay in a place.</div>
        <button class="start-btn" onclick="enterApp()">Click Here to Start Your Journey</button>
    </div>

    <div id="loginOverlay" class="hidden">
        <div class="login-box">
            <h2>Student Entry</h2>
            <input type="text" id="studentNameInput" placeholder="Enter Full Name...">
            <button class="main-btn" onclick="saveStudentName()">Continue</button>
        </div>
    </div>

    <button class="mode-toggle" onclick="protectedToggle()">Manager Mode</button>

    <div class="app-container">
        <div id="syncStatus" style="font-size: 0.75rem; color: #94a3b8; text-align:center; margin-bottom:10px;">Syncing...</div>
        <div id="studyView" class="panel">
            <div id="unitSelection">
                <label><strong>Select Unit</strong></label>
                <div id="unitBtnGrid" class="nav-grid"></div>
            </div>
            <div id="listSelection" class="hidden">
                <div class="breadcrumb" onclick="backToUnits()">&larr; Back to Units</div>
                <div id="listBtnGrid" class="nav-grid"></div>
            </div>
            <div id="studyInterface" class="hidden">
                <div class="breadcrumb" onclick="backToLists()">&larr; Back to Lists</div>
                <h3 id="activeListName" style="margin:5px 0;"></h3>
                <div id="studentWelcome" style="font-size: 0.8rem; color: #64748b; margin-bottom: 10px;"></div>
                <div class="study-tabs">
                    <button id="tabList" class="active" onclick="setStudyMode('list')">List</button>
                    <button id="tabFlash" onclick="setStudyMode('flash')">Flashcards</button>
                    <button id="tabQuiz" onclick="setStudyMode('quiz')">Quiz</button>
                    <button id="tabMatch" onclick="setStudyMode('match')">Matching</button>
                </div>
                <div id="listMode"><div id="fullListArea"></div><div id="historyLogArea" style="margin-top:20px; background:#f8fafc; padding:15px; border-radius:8px;"><h4 style="margin:0 0 10px 0;">Session Performance:</h4><div id="historyEntries">No attempts yet.</div></div></div>
                <div id="flashMode" class="hidden"><div class="flashcard" id="cardContainer" onclick="this.classList.toggle('flipped')"><div class="inner"><div class="front" id="displayTerm"></div><div class="back" id="displayDef"></div></div></div><div style="display:flex; gap:10px;"><button class="main-btn" onclick="changeCard(-1)">Prev</button><button class="main-btn" onclick="changeCard(1)">Next</button></div></div>
                <div id="quizMode" class="hidden"><div id="quizStats" style="text-align:right; font-weight:bold; color:var(--primary);">Score: 0/0</div><div id="quizContent"><div id="quizQuestion" style="font-weight:bold; margin-bottom:15px;"></div><div id="quizOptions"></div><button id="nextQuizBtn" class="hidden main-btn" onclick="renderQuiz()">Next Question</button></div><div id="quizEnd" class="hidden" style="text-align:center;"></div></div>
                <div id="matchMode" class="hidden"><div id="matchStats" style="text-align:right; font-weight:bold; color:var(--primary);">Accuracy: 0%</div><div id="matchContainer" class="match-container"></div><div id="matchEnd" class="hidden" style="text-align:center;"></div></div>
            </div>
        </div>
        <div id="adminView" class="panel hidden">
            <div class="breadcrumb" onclick="protectedToggle()">&larr; Exit Manager</div>
            <h3>Manager Mode (Live Edit)</h3>
            <select id="adminDropdown" onchange="renderAdminList(this.value)"></select>
            <div id="addWordForm" class="hidden"><h4>+ Add New Word</h4><input type="text" id="newT" placeholder="Term"><input type="text" id="newD" placeholder="Definition"><input type="text" id="newI" placeholder="Image URL"><button class="main-btn" onclick="submitNewWord()">Add to Google Sheet</button></div>
            <div id="adminWordList"></div>
        </div>
    </div>

    <script>
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSwbPmk1KJuwC8y8oBy_oKB7N8LMfgJcA7LykdRSsaAj-imKQnf4ZkF6h6A28P74Ibx-lRtHclXtlF4/pub?gid=0&single=true&output=csv";
        const EXPORT_URL = "PASTE_YOUR_NEW_DEPLOYMENT_URL_HERE"; 
        const ADMIN_PASS = "science123";

        let units = {}, currentUnit = "", currentClass = "", cardIdx = 0, studentName = "", draggedItem = null;
        let sessionHistory = [];
        let vocabWords = ["Sojourn", "Voyage", "Lexicon", "Knowledge", "Linguistics"]; 

        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        let columns = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            columns = Array(Math.floor(canvas.width / 20)).fill(0);
        }

        function drawMatrix() {
            ctx.fillStyle = "rgba(10, 15, 28, 0.15)"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#3b82f6"; 
            ctx.font = "bold 15px monospace";
            columns.forEach((y, i) => {
                const word = vocabWords[Math.floor(Math.random() * vocabWords.length)];
                ctx.fillText(word, i * 25, y);
                if (y > canvas.height && Math.random() > 0.95) columns[i] = 0;
                else columns[i] = y + 25;
            });
        }

        window.onload = () => {
            fetchTeacherData();
            resizeCanvas();
            setInterval(drawMatrix, 50);
        };

        function enterApp() { 
            // FADE OUT SPLASH
            document.getElementById('landingPage').style.opacity = '0'; 
            canvas.style.opacity = '0';
            
            // FADE IN APP CONTENT
            const container = document.querySelector('.app-container');
            const toggle = document.querySelector('.mode-toggle');
            container.style.opacity = '1';
            container.style.pointerEvents = 'auto';
            toggle.style.opacity = '0.6';
            toggle.style.pointerEvents = 'auto';

            setTimeout(() => { 
                document.getElementById('landingPage').classList.add('hidden'); 
                canvas.classList.add('hidden');
                document.getElementById('loginOverlay').classList.remove('hidden'); 
            }, 800); 
        }

        // JS LOGIC FOR STUDY MODES (Unchanged from prev version for brevity)
        function saveStudentName() { studentName = document.getElementById('studentNameInput').value; document.getElementById('loginOverlay').classList.add('hidden'); document.getElementById('studentWelcome').innerText = "Student: " + studentName; }
        async function fetchTeacherData() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                const csvText = await response.text();
                const rows = csvText.split(/\r?\n/).slice(1);
                units = {}; let tempWords = [];
                rows.forEach(row => {
                    const splitCols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (splitCols.length >= 2) {
                        const t = splitCols[0].replace(/"/g, ''), d = splitCols[1].replace(/"/g, ''), l = splitCols[3].replace(/"/g, ''), u = splitCols[4].replace(/"/g, '');
                        if (!units[u]) units[u] = {};
                        if (!units[u][l]) units[u][l] = [];
                        units[u][l].push({t, d}); tempWords.push(t);
                    }
                });
                if(tempWords.length > 0) vocabWords = tempWords;
                renderUnitSelection();
            } catch (e) { console.error(e); }
        }
        function renderUnitSelection() { document.getElementById('unitBtnGrid').innerHTML = Object.keys(units).map(u => `<button class="nav-btn" onclick="selectUnit('${u}')">${u}</button>`).join(''); }
        function selectUnit(u) { currentUnit = u; document.getElementById('unitSelection').classList.add('hidden'); document.getElementById('listSelection').classList.remove('hidden'); document.getElementById('listBtnGrid').innerHTML = Object.keys(units[u]).map(l => `<button class="nav-btn" onclick="selectList('${l}')">${l}</button>`).join(''); }
        function selectList(l) { currentClass = l; document.getElementById('listSelection').classList.add('hidden'); document.getElementById('studyInterface').classList.remove('hidden'); document.getElementById('activeListName').innerText = l; setStudyMode('list'); }
        function backToUnits() { document.getElementById('listSelection').classList.add('hidden'); document.getElementById('unitSelection').classList.remove('hidden'); }
        function backToLists() { document.getElementById('studyInterface').classList.add('hidden'); document.getElementById('listSelection').classList.remove('hidden'); }
        function setStudyMode(mode) {
            ['tabList', 'tabFlash', 'tabQuiz', 'tabMatch'].forEach(t => document.getElementById(t).classList.remove('active'));
            document.getElementById('tab' + mode.charAt(0).toUpperCase() + mode.slice(1)).classList.add('active');
            ['listMode', 'flashMode', 'quizMode', 'matchMode'].forEach(m => document.getElementById(m).classList.add('hidden'));
            document.getElementById(mode + 'Mode').classList.remove('hidden');
            if (mode === 'list') renderFullList(units[currentUnit][currentClass]);
        }
        function renderFullList(list) { document.getElementById('fullListArea').innerHTML = list.map(i => `<div style="padding:10px; border-bottom:1px solid #eee;"><strong>${i.t}</strong>: ${i.d}</div>`).join(''); }
        function protectedToggle() {
            if (document.getElementById('adminView').classList.contains('hidden')) {
                if (prompt("Password:") === ADMIN_PASS) {
                    document.getElementById('studyView').classList.add('hidden');
                    document.getElementById('adminView').classList.remove('hidden');
                }
            } else {
                document.getElementById('adminView').classList.add('hidden');
                document.getElementById('studyView').classList.remove('hidden');
            }
        }
    </script>
</body>
</html>